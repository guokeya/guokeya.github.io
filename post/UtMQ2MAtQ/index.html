<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>æµ…æUnicodeå®‰å…¨ | è¿‡å®¢</title>
<meta name="description" content="this is a test Web">

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://guokeya.github.io/favicon.ico?v=1582641672943">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://guokeya.github.io/styles/main.css">



<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>

<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />



  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://guokeya.github.io">
        <img src="https://guokeya.github.io/images/avatar.png?v=1582641672943" class="site-logo">
        <h1 class="site-title">è¿‡å®¢</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="/" class="site-nav">
            é¦–é¡µ
          </a>
        
      
        
          <a href="/archives" class="site-nav">
            å½’æ¡£
          </a>
        
      
        
          <a href="/post/about" class="site-nav">
            å…³äº
          </a>
        
      
        
          <a href="/tags" class="site-nav">
            åˆ†ç±»
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
      
        
      
        
      
        
      
        
      
    </div>
    <div class="site-description">
      this is a test Web
    </div>
    <div class="site-footer">
       | <a class="rss" href="https://guokeya.github.io/atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">æµ…æUnicodeå®‰å…¨</h2>
            <div class="post-date">2020-01-04</div>
            
            <div class="post-content">
              <p>æºäºBlack hat 2019çš„ä¸€ä¸ªè®®é¢˜ã€‚åˆ·é¢˜çš„æ—¶å€™ä¹Ÿå‡ºç°äº†è¿™ç±»çŸ¥è¯†ç‚¹<br>
<code>https://i.blackhat.com/USA-19/Thursday/us-19-Birch-HostSplit-Exploitable-Antipatterns-In-Unicode-Normalization.pdf</code><br>
ç„¶è€Œã€‚å…¨è‹±æ–‡ã€‚å¿ƒç´¯</p>
<!-- more -->
<p><strong>å¤§æ¦‚</strong><br>
ç»™å‡ºäº†ğ“€¬.netè¿™æ ·çš„ç½‘å€ã€‚ä½†æ˜¯ä¼šè§£ææˆhttp://xn--fq7d.net/<br>
ä¸ºä»€ä¹ˆå‘¢ã€‚è¿™å°±éœ€è¦ä»ç¼–ç è§£ç å¼€å§‹å°†<br>
1:IDN<br>
å›½é™…åŒ–åŸŸåIDNSã€‚å°±æ˜¯éè‹±æ–‡è¡¨ç¤ºçš„åŸŸåã€‚æ¯”å¦‚èœ.cnè¿™ç§<br>
2:Punycode<br>
æ˜¯ä¸€ç§è¡¨ç¤ºUnicdoeç å’ŒAsciiç çš„å­—ç¬¦é›†ã€‚ä¾‹å¦‚<br>
mÃ¼nchenä¼šç¼–ç æˆmnchen-3ya<br>
åœ¨IDNSæ¨å‡ºä»¥åã€‚ä¸ºäº†ä¿è¯å…¼å®¹ä»¥å‰çš„DNSã€‚æ‰€ä»¥å¯¹éè‹±è¯­çš„å­—ç¬¦è¿›è¡Œpunycodeè½¬ç ã€‚è½¬ç åçš„punycodeç”±26ä¸ªå­—æ¯+10ä¸ªæ•°å­—å’Œ-ç»„æˆ<br>
IDNç¼–ç è¿‡ç¨‹</p>
<pre><code>Unicode â” ASCII â€“ A Two Step Process
1:Normalizationï¼ˆæ ‡å‡†åŒ–ï¼‰
å°†å­—ç¬¦è½¬æ¢ä¸ºâ€œæ ‡å‡†æ ¼å¼â€ã€‚
æˆ‘æ„Ÿè§‰æ›´åƒæ ¼å¼åŒ–ã€‚æŠŠå„ç§å„æ ·å„åœ°çš„å­—ç¬¦è½¬æ¢æˆä¸€ä¸ªæ ‡å‡†å½¢å¼ã€‚
2: Punycoding
å°†Unicodeè½¬æ¢ä¸ºASCII
åœ¨ç»è¿‡Normalizationè¿™ä¸ªéƒ¨åˆ†æ—¶ã€‚æœ‰äº›å­—ç¬¦ç›´æ¥å˜æˆASCIIç ã€‚å¦‚æœå†Punycodingã€‚é‚£ä¹ˆæ²¡å•¥åŒºåˆ«ã€‚è¿˜æ˜¯ASCIIç 
</code></pre>
<p>è¿™ä¸ªa/cç‰¹æ®Šå­—ç¬¦ã€‚ç»è¿‡æ ‡å‡†åŒ–åã€‚å°±å˜æˆäº†a/c<br>
<img src="https://guokeya.github.io/post-images/1578146026511.png" alt="" loading="lazy"><br>
å€ŸåŠ©altmanå¤§ä½¬çš„fuzzè„šæœ¬ã€‚å¯ä»¥æŠŠç±»ä¼¼çš„å­—ç¬¦éƒ½è¾“å‡ºå‡ºæ¥ã€‚</p>
<pre><code>for i in range(128,65537):
	tmp=chr(i)
	try:
		res = tmp.encode('idna').decode('utf-8')
		if(&quot;-&quot;) in res:
			continue
		print(&quot;U:{} A:{} ascii:{} &quot;.format(tmp,res,i))
	except:
		pass
</code></pre>
<p>å¯ä»¥åˆ©ç”¨grepè¾“å‡ºunicodeè½¬æ¢ä¸ºASCIIåä¸º3çš„å­—ç¬¦<br>
<img src="https://guokeya.github.io/post-images/1578146188481.png" alt="" loading="lazy"><br>
<strong>å…·ä½“åˆ©ç”¨ä»¥ä¸¤é¢˜CTFä¸ºä¾‹</strong><br>
<strong>BUUCTF(ASIS 2019]Unicorn shop)</strong><br>
åå­—å«ç‹¬è§’å…½å•†åº—ã€‚å•†å“æœ‰ä¸ªç‹¬è§’å…½ã€‚<br>
<img src="https://guokeya.github.io/post-images/1578146336349.png" alt="" loading="lazy"><br>
è´­ä¹°IDä¸º1ï¼Œ2ï¼Œ3éƒ½ä¼šæŠ¥é”™Wrong commodity!å•†å“ä¸å¯¹<br>
IDä¸º4æ˜¯è´­ä¹°ç‹¬è§’å…½ã€‚ç»è¿‡æµ‹è¯•ã€‚åªèƒ½è¾“å…¥ä¸€ä¸ªå­—ç¬¦ã€‚<br>
å¹¶ä¸”è¾“å…¥0-9ä»»æ„å­—ç¬¦ã€‚éƒ½ä¼šè¾“å‡ºYou don't have enough money!<br>
è¿™é‡Œå°±éœ€è¦UnicodeçŸ¥è¯†äº†<br>
è¾“å…¥ä¸€ä¸ªå­—ç¬¦ä»£è¡¨æ•°å­—ã€‚å¹¶ä¸”å­—ç¬¦çš„æ„ä¹‰è¦å¤§äº1337ã€‚åªè¦æ‰¾åˆ°æ»¡è¶³è¿™ä¸ªæ¡ä»¶çš„å­—ç¬¦ã€‚ç»è¿‡åå°ç¼–ç åã€‚å°±ä¼šè½¬æ¢ä¸ºå¤§äº1337çš„æ•°å­—ã€‚åå°è¿›è¡Œåˆ¤æ–­å°±å¯ä»¥æˆåŠŸè´­ä¹°äº†<br>
<code>https://www.compart.com/en/unicode/</code><br>
è¾“å…¥æ¡ä»¶Ten Thousand(ä¸€ä¸‡ã€‚åªè¦å¤§äº1337å°±è¡Œäº†)<br>
<img src="https://guokeya.github.io/post-images/1578146633458.png" alt="" loading="lazy"><br>
éšä¾¿ç‚¹å‡ ä¸ªã€‚çœ‹numeric valueï¼Œè¿™ä¸ªå­—ç¬¦ä»£è¡¨çš„å°±æ˜¯æ•°å­—1W<br>
<img src="https://guokeya.github.io/post-images/1578146731763.png" alt="" loading="lazy"><br>
å¤åˆ¶ç²˜è´´ï¼ŒæˆåŠŸæ‹¿åˆ°flag<br>
<img src="https://guokeya.github.io/post-images/1578146818233.png" alt="" loading="lazy"><br>
<strong>2019suctf(Pythonginx)</strong><br>
é¢˜ç›®æºç ï¼šå³é”®æºä»£ç æœ‰</p>
<pre><code>from flask import Flask, Blueprint, request, Response, escape ,render_template
from urllib.parse import urlsplit, urlunsplit, unquote
from urllib import parse
import urllib.request

app = Flask(__name__)

# Index
@app.route('/', methods=['GET'])
def app_index():
    return render_template('index.html')

@app.route('/getUrl', methods=['GET', 'POST'])
def getUrl():
    url = request.args.get(&quot;url&quot;)
    host = parse.urlparse(url).hostname
    if host == 'suctf.cc':
        return &quot;æˆ‘æ‰Œ your problem? 111&quot;
    parts = list(urlsplit(url))
    host = parts[1]
    if host == 'suctf.cc':
        return &quot;æˆ‘æ‰Œ your problem? 222 &quot; + host
    newhost = []
    for h in host.split('.'):
        newhost.append(h.encode('idna').decode('utf-8'))
    parts[1] = '.'.join(newhost)
    #å»æ‰ url ä¸­çš„ç©ºæ ¼
    finalUrl = urlunsplit(parts).split(' ')[0]
    host = parse.urlparse(finalUrl).hostname
    if host == 'suctf.cc':
        return urllib.request.urlopen(finalUrl).read()
    else:
        return &quot;æˆ‘æ‰Œ your problem? 333&quot;

if __name__ == &quot;__main__&quot;:
    app.run(host='0.0.0.0', port=80)
</code></pre>
<p>å¤§è‡´æ„æ€å°±æ˜¯ã€‚æ¥æ”¶æˆ‘ä»¬ä¼ å…¥çš„å€¼<br>
ç„¶åé€šè¿‡urlparseè§£æã€‚hostnameä¸èƒ½ç­‰äºsuctf.cc<br>
ç„¶åå°†å…¶åˆ†å‰²ã€‚å–ç¬¬äºŒä¸ªå€¼ã€‚ä¸èƒ½ç­‰äºsuctf.cc<br>
æœ€åå°†å€¼utf-8è§£ç ã€‚ç­‰äºsuctf.ccï¼Œå°±ä¼šè¯»å–æˆ‘ä»¬ä¼ å…¥çš„å€¼<br>
æ¯æ¬¡å¤„ç†çš„ç»“æœå¦‚ä¸‹ã€‚<br>
<img src="https://guokeya.github.io/post-images/1578147531827.png" alt="" loading="lazy"><br>
æµ‹è¯•æºç </p>
<pre><code>import urllib
from urllib import parse
from urllib.parse import urlsplit,urlunsplit
url='file://suctf.cc/../../../../../../etc/passwd'
host=parse.urlparse(url).hostname
print(&quot;first host :&quot;,host)
parts=list(urlsplit(url))
print (parts)
host=parts[1]
print(&quot;Second host :&quot;,host)
newhost=[]
for h in host.split('.'):
    newhost.append(h.encode('idna').decode('utf-8'))
parts[1]='.'.join(newhost)
finaurl=urlunsplit(parts).split(' ')[0]
host=parse.urlparse(finaurl).hostname
print(&quot;end host :&quot;,host)
</code></pre>
<p>UnicodeçŸ¥è¯†ã€‚ã€‚ã€‚å¦‚æœæˆ‘ä»¬å°†å…¶ä¸­çš„ä¸€ä¸ªå­—ç¬¦æ›¿æ¢ä¸ºæ€ªå¼‚å­—ç¬¦ã€‚å‰ä¸¤æ¬¡åˆ¤æ–­suctf.câ‘¢ç»•è¿‡ã€‚ç¬¬ä¸‰æ¬¡ASCIIè½¬ç åå˜æˆ3ã€‚æ»¡è¶³æ¡ä»¶ã€‚æ‰§è¡Œæˆ‘ä»¬çš„file://suctf.cc/../../../../etc/passwdï¼Œå³å¯è¯»å–æ–‡ä»¶<br>
åˆ©ç”¨æ–‡ç« å¼€å¤´çš„FUZZè„šæœ¬ã€‚æˆ‘ä»¬æ‰¾åˆ°ASCIIåä¸ºcçš„ç‰¹æ®Šå­—ç¬¦<br>
<img src="https://guokeya.github.io/post-images/1578148878500.PNG" alt="" loading="lazy"><br>
æ„é€ payload:file://suctf.cï¼£/../../../../etc/passwd<br>
<img src="https://guokeya.github.io/post-images/1578148934514.PNG" alt="" loading="lazy"><br>
è¯»å–nginxæ–‡ä»¶ï¼Œå‘ç°flagåœ°å€<br>
<img src="https://guokeya.github.io/post-images/1578149035409.PNG" alt="" loading="lazy"><br>
è¯»å–ï¼Œæ‹¿åˆ°flag<br>
<img src="https://guokeya.github.io/post-images/1578149080906.PNG" alt="" loading="lazy"><br>
è¿˜æœ‰ä¸€ç§éé¢„æœŸè§£æ³•ï¼š<br>
parseæ˜¯è§£æURLçš„ã€‚PHPä¸Šparseèƒ½é€šè¿‡/æ¥å¹²æ‰°è§£ç ç»“æœï¼Œpythonä¸­ä¹Ÿå¯ä»¥<br>
å½“urlä¸ºfile:////suctf.cc/../../../../../etc/passwd<br>
å‰ä¸¤ä¸ªè§£æç»“æœä¸ºNULLï¼Œæœ€åè§£æä¸ºsuctfã€‚åŒæ ·ç»•è¿‡äº†åˆ¤æ–­<br>
<img src="https://guokeya.github.io/post-images/1578149234523.PNG" alt="" loading="lazy"><br>
ä»¥ä¸‹æ˜¯æ¯æ­¥çš„è§£æç»“æœ<br>
<img src="https://guokeya.github.io/post-images/1578149519508.PNG" alt="" loading="lazy"></p>

            </div>
            
              <div class="tag-container">
                
                  <a href="https://guokeya.github.io/tag/CTF/" class="tag">
                    CTF
                  </a>
                
                  <a href="https://guokeya.github.io/tag/Web/" class="tag">
                    Webå®‰å…¨
                  </a>
                
              </div>
            
            
              <div class="next-post">
                <div class="next">ä¸‹ä¸€ç¯‡</div>
                <a href="https://guokeya.github.io/post/wJqAq8fzp/">
                  <h3 class="post-title">
                    Pwn(æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´)
                  </h3>
                </a>
              </div>
            

            

          </div>

        </div>
      </div>
    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>

<script type="application/javascript">

AOS.init();

hljs.initHighlightingOnLoad()

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>




  </body>
</html>
